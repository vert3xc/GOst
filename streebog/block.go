package streebog

func block(s *streebogHash, p []byte){
	state := s.state
	n := s.n
	sigma := s.sigma
	for len(p) >= 64 {
		var m [64]byte
		for i, b := range p[:64] {
			m[i] = b
		}

		G(&state, &m, &n)

		add512(&n, &v)
		add512(&sigma, &m)

		p = p[64:]
	}
	if len(p) > 0 {
		lb := len(p) * 8
		l := [64]byte{
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			byte((lb & 0xff00) >> 8),
			byte(lb & 0xff),
		}
		var m [64]byte
		m[64-len(p)-1] = 1
		for i, b := range p {
			m[64-len(p)+i] = b
		}
		G(&state, &m, &n)

		add512(&n, &l)
		add512(&sigma, &m)
	}
	s.state = state
	s.n = n
	s.sigma = sigma
}

func finalize(s *streebogHash){
	state := s.state
	G(&state, &s.n, &zeros)
	G(&state, &s.sigma, &zeros)
	s.state = state
}